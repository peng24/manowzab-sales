import{r as d,c as se,o as oe,e as u,f as e,g as C,E as $,M as ae,q as le,w as x,v as b,G as H,F as V,i as B,D as re,N as ne,a as ue,k as O,H as I,I as D,J as L,O as z,P as de,K as ie,S as v,u as ce,j as F,n as me,p as n,t as f,Q as pe,x as xe,h as fe,L as ve,y as E,z as ge,A as ye}from"./index-SOffZJ6w.js";import{A as be}from"./arrow-left-uSSRtKac.js";const we={class:"container mx-auto max-w-7xl px-4 py-8"},he={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},ke={class:"flex items-center gap-4"},_e={class:"flex flex-col gap-3 sm:flex-row sm:items-center w-full md:w-auto"},Ce={class:"relative w-full sm:w-64"},De={class:"flex items-center gap-2"},Ne=["value"],Te=["value"],Me={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},Ve={class:"overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200"},Oe={class:"bg-white divide-y divide-gray-200"},Ee={key:0},Se={key:1},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},je={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm"},$e={key:1,class:"text-gray-600"},He={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},Ie={class:"px-6 py-4 whitespace-nowrap"},Le={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ze=["onClick"],Fe=["onClick"],qe={key:0,class:"bg-gray-50 px-6 py-4 text-center border-t border-gray-200"},Ye={key:1,class:"bg-gray-50 px-6 py-4 text-center border-t border-gray-200"},Re={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Qe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ge={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Je={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ke={class:"space-y-4"},Ze={__name:"AllSalesView",setup(Pe){const q=ae(),m=d(!1),l=d([]),g=d(null),y=d(!0),S=new Date,w=d(S.getMonth()),h=d(S.getFullYear()),p=d(""),N=d(null),T=d(!1),k=d(null),r=d({date:"",time:"",customerName:"",amount:0}),Y=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],R=se(()=>{const o=new Date().getFullYear(),t=[];for(let a=o-2;a<=o+1;a++)t.push(a);return t}),U=()=>{l.value=[],g.value=null,y.value=!0,_()},Q=()=>{N.value&&clearTimeout(N.value),l.value=[],g.value=null,N.value=setTimeout(()=>{_()},500)},_=async()=>{m.value=!0;try{const o=re(new Date(h.value,w.value)),t=ne(new Date(h.value,w.value)),a=ue(O,"sales");let s;if(p.value)s=I(a,D("dateTime",">=",o),D("dateTime","<=",t),L("dateTime","desc"),z(500));else{let c=[D("dateTime",">=",o),D("dateTime","<=",t),L("dateTime","desc"),z(20)];g.value&&c.push(de(g.value)),s=I(a,...c)}const i=await ie(s);if(i.empty){y.value=!1,m.value=!1;return}!p.value&&i.docs.length<20&&(y.value=!1),g.value=i.docs[i.docs.length-1];const j=i.docs.map(c=>({id:c.id,...c.data()}));if(p.value){const c=p.value.toLowerCase(),Z=j.filter(A=>{const ee=(A.orderNo||"").toLowerCase(),te=(A.customerName||"").toLowerCase();return ee.includes(c)||te.includes(c)});l.value=Z}else l.value.push(...j)}catch(o){console.error("Error fetching sales:",o),v.fire("Error",o.message,"error")}finally{m.value=!1}},G=()=>{!y.value||m.value||_()},J=async o=>{if((await v.fire({title:"ยืนยันการลบ?",text:`ต้องการลบรายการ ${o.orderNo||""} นี้หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await ye(F(O,"sales",o.id)),l.value=l.value.filter(a=>a.id!==o.id),v.fire("Deleted!","ลบรายการสำเร็จ","success")}catch(a){v.fire("Error",a.message,"error")}},K=o=>{k.value=o.id;let t=new Date;o.dateTime&&o.dateTime.toDate?t=o.dateTime.toDate():o.date&&(t=new Date(o.date)),r.value={date:E(t,"yyyy-MM-dd"),time:E(t,"HH:mm"),customerName:o.customerName||"",amount:o.amount||0},T.value=!0},M=()=>{T.value=!1,k.value=null},P=async()=>{try{const o=new Date(`${r.value.date}T${r.value.time}`),t={dateTime:o,date:o,customerName:r.value.customerName,amount:Number(r.value.amount)};await ce(F(O,"sales",k.value),t);const a=l.value.findIndex(s=>s.id===k.value);a!==-1&&(l.value[a]={...l.value[a],...t}),v.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),M()}catch(o){console.error("Update error:",o),v.fire("Error","บันทึกไม่สำเร็จ","error")}},W=o=>{if(!o)return"-";try{const t=o.toDate?o.toDate():new Date(o),a=t.getFullYear()+543;return E(t,`d MMM ${String(a).slice(-2)} HH:mm`,{locale:ge})}catch{return"-"}},X=o=>new Intl.NumberFormat("th-TH").format(o||0);return oe(()=>{_()}),(o,t)=>{const a=me("router-link");return n(),u("div",we,[e("div",he,[e("div",ke,[e("button",{onClick:t[0]||(t[0]=s=>$(q).push("/")),class:"flex items-center justify-center rounded-lg border border-gray-200 bg-white p-2 text-gray-600 shadow-sm hover:bg-gray-50 hover:text-blue-600 transition-colors"},[le($(be),{class:"h-5 w-5"})]),t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"ประวัติยอดขายทั้งหมด"),e("p",{class:"text-gray-500"},"จัดการรายการขายและตรวจสอบย้อนหลัง")],-1))]),e("div",_e,[e("div",Ce,[t[9]||(t[9]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),x(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),onInput:Q,placeholder:"ค้นหา Order No, ชื่อลูกค้า...",class:"block w-full rounded-lg border-gray-300 pl-10 focus:border-blue-500 focus:ring-blue-500 shadow-sm"},null,544),[[b,p.value]])]),e("div",De,[x(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),onChange:U,class:"rounded-lg border-gray-300 bg-white px-3 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(n(),u(V,null,B(Y,(s,i)=>e("option",{key:i,value:i},f(s),9,Ne)),64))],544),[[H,w.value]]),x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),onChange:U,class:"rounded-lg border-gray-300 bg-white px-3 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(n(!0),u(V,null,B(R.value,s=>(n(),u("option",{key:s,value:s},f(s),9,Te))),128))],544),[[H,h.value]])])])]),e("div",Me,[e("div",Ve,[e("table",Be,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"วันที่"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"Order No."),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ชื่อลูกค้า"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ยอดเงิน"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ประเภท"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"จัดการ")])],-1)),e("tbody",Oe,[m.value&&l.value.length===0?(n(),u("tr",Ee,[...t[10]||(t[10]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"},"กำลังโหลดข้อมูล...",-1)])])):l.value.length===0?(n(),u("tr",Se,[...t[11]||(t[11]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"},"ไม่พบรายการขายในเดือนนี้",-1)])])):C("",!0),(n(!0),u(V,null,B(l.value,s=>(n(),u("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ue,f(W(s.dateTime)),1),e("td",je,f(s.orderNo||"-"),1),e("td",Ae,[s.customerName?(n(),pe(a,{key:0,to:{name:"CustomerDetail",params:{name:s.customerName}},class:"text-blue-600 hover:text-blue-800 hover:underline font-medium"},{default:xe(()=>[fe(f(s.customerName),1)]),_:2},1032,["to"])):(n(),u("span",$e,"ไม่ระบุ"))]),e("td",He," ฿"+f(X(s.amount)),1),e("td",Ie,[e("span",{class:ve(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-blue-100 text-blue-800":s.type==="COD","bg-green-100 text-green-800":s.type!=="COD"}])},f(s.type==="COD"?"COD":"โอนเงิน"),3)]),e("td",Le,[e("button",{onClick:i=>K(s),class:"text-indigo-600 hover:text-indigo-900 mr-4"},"แก้ไข",8,ze),e("button",{onClick:i=>J(s),class:"text-red-600 hover:text-red-900"},"ลบ",8,Fe)])]))),128))])])]),y.value&&!p.value&&!m.value?(n(),u("div",qe,[e("button",{onClick:G,class:"text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors"}," โหลดเพิ่มเติม... ")])):C("",!0),m.value&&l.value.length>0?(n(),u("div",Ye,[...t[13]||(t[13]=[e("span",{class:"text-sm text-gray-500"},"กำลังโหลด...",-1)])])):C("",!0)]),T.value?(n(),u("div",Re,[e("div",Qe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:M}),t[19]||(t[19]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ge,[e("div",Je,[t[18]||(t[18]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4",id:"modal-title"},"แก้ไขรายการขาย",-1)),e("div",Ke,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"วันที่",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.date=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,r.value.date]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"เวลา",-1)),x(e("input",{type:"time","onUpdate:modelValue":t[5]||(t[5]=s=>r.value.time=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,r.value.time]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อลูกค้า",-1)),x(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>r.value.customerName=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,r.value.customerName]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"ยอดเงิน",-1)),x(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=s=>r.value.amount=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,r.value.amount,void 0,{number:!0}]])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{onClick:P,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"},"บันทึก"),e("button",{onClick:M,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"},"ยกเลิก")])])])])):C("",!0)])}}};export{Ze as default};
