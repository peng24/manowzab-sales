import{r as m,c as U,o as j,a as T,b as S,d as z,e as c,f as e,g as E,h as p,w as x,v as f,i as k,F as L,j as A,t as a,k as H,T as $,l as _,m as q,n,p as F,q as I,u as Q,s as R,S as i,x as G,y as N,z as J,A as K,B as O,C as P}from"./index-B3zZU_Hv.js";const W={class:"container mx-auto max-w-7xl px-4 py-8"},X={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},Y={class:"mb-6 rounded-xl bg-white p-4 shadow-sm border border-gray-100"},Z={class:"relative max-w-md"},ee={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},te={class:"overflow-x-auto"},se={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},re={key:0},le={key:1},ae={class:"px-6 py-4 whitespace-nowrap"},ne={class:"flex items-center"},ie={class:"h-10 w-10 flex-shrink-0 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold"},de={class:"ml-4"},ue={class:"text-xs text-gray-400"},ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},me=["title"],pe={class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-center"},fe={class:"flex items-center justify-end gap-2"},be=["onClick"],ve=["onClick","data-customer-id"],we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ge={class:"relative w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl animate-fade-in-up"},he={class:"flex items-center justify-between mb-6"},ye={class:"text-lg font-bold text-gray-800"},ke={class:"space-y-1"},_e=["disabled"],Ce={key:0,class:"text-xs text-gray-400"},Be={class:"space-y-1"},Ne={class:"space-y-1"},Me={class:"space-y-1"},De={class:"flex justify-end gap-3 pt-2"},Ve={type:"submit",class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 transition-colors"},Te={__name:"CustomersView",setup(Ue){const w=m([]),d=m(!0),b=m(""),g=m(!1),u=m(!1);let h=null;const r=m({name:"",phoneNumber:"",address:"",note:""}),C=U(()=>{if(!b.value)return w.value;const o=b.value.toLowerCase();return w.value.filter(t=>t.name.toLowerCase().includes(o)||t.phoneNumber&&t.phoneNumber.includes(o))});j(()=>{const o=T(_,"customers");h=S(o,t=>{w.value=t.docs.map(l=>({id:l.id,...l.data()})),d.value=!1},t=>{console.error("Error fetching customers:",t),d.value=!1})}),z(()=>{h&&h()});const B=(o=null)=>{o?(u.value=!0,r.value={name:o.id,phoneNumber:o.phoneNumber||"",address:o.address||"",note:o.note||""}):(u.value=!1,r.value={name:"",phoneNumber:"",address:"",note:""}),g.value=!0},v=()=>{g.value=!1},M=async()=>{if(!r.value.name.trim()){i.fire({icon:"warning",title:"กรุณาระบุชื่อลูกค้า"});return}try{const o=r.value.name.trim(),t=N(_,"customers",o),l={name:o,phoneNumber:r.value.phoneNumber||"",address:r.value.address||"",note:r.value.note||"",lastUpdate:J()};if(u.value){const{name:s,...y}=l;await K(t,y),i.fire({icon:"success",title:"แก้ไขข้อมูลสำเร็จ",timer:1500,showConfirmButton:!1})}else{if((await O(t)).exists()){i.fire({icon:"error",title:"ลูกค้าชื่อนี้มีอยู่แล้ว",text:"กรุณาใช้ชื่ออื่น"});return}await P(t,l),i.fire({icon:"success",title:"เพิ่มลูกค้าสำเร็จ",timer:1500,showConfirmButton:!1})}v()}catch(o){console.error("Error saving customer:",o),i.fire({icon:"error",title:"บันทึกไม่สำเร็จ",text:o.message})}},D=async o=>{if(!d.value)try{if((await i.fire({icon:"warning",title:"ยืนยันการลบ",html:`ต้องการลบข้อมูลลูกค้า <b>"${o.name}"</b> หรือไม่?`,showCancelButton:!0,showDenyButton:!1,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"ลบข้อมูล",cancelButtonText:"ยกเลิก"})).isConfirmed){d.value=!0;try{await G(N(_,"customers",o.id)),await i.fire({icon:"success",title:"ลบสำเร็จ!",text:"ข้อมูลลูกค้าถูกลบแล้ว",timer:1500,showConfirmButton:!1})}catch(l){console.error("Error deleting customer:",l),await i.fire({icon:"error",title:"Error",text:"ลบข้อมูลไม่สำเร็จ: "+l.message})}finally{d.value=!1}}}catch(t){console.error("Unexpected error in deleteCustomer:",t),d.value=!1}},V=R;return(o,t)=>{const l=q("router-link");return n(),c("div",W,[e("div",X,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"}," ข้อมูลลูกค้า (Customers) "),e("p",{class:"text-gray-500"}," จัดการรายชื่อลูกค้า เบอร์โทร และที่อยู่จัดส่ง ")],-1)),e("button",{onClick:t[0]||(t[0]=s=>B()),class:"flex items-center rounded-lg bg-blue-600 px-4 py-2 font-bold text-white shadow-md hover:bg-blue-700 transition-colors"},[...t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1),p(" เพิ่มลูกค้าใหม่ ",-1)])])]),e("div",Y,[e("div",Z,[t[8]||(t[8]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),x(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),placeholder:"ค้นหาชื่อลูกค้า หรือเบอร์โทร...",class:"block w-full rounded-lg border-gray-300 pl-10 focus:border-blue-500 focus:ring-blue-500"},null,512),[[f,b.value]])])]),e("div",ee,[e("div",te,[e("table",se,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ชื่อลูกค้า "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," เบอร์โทรศัพท์ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ที่อยู่จัดส่ง "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," หมายเหตุ "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," จัดการ ")])],-1)),e("tbody",oe,[d.value?(n(),c("tr",re,[...t[9]||(t[9]=[e("td",{colspan:"5",class:"px-6 py-10 text-center text-gray-500"}," กำลังโหลดข้อมูล... ",-1)])])):C.value.length===0?(n(),c("tr",le,[...t[10]||(t[10]=[e("td",{colspan:"5",class:"px-6 py-10 text-center text-gray-500"}," ไม่พบข้อมูลลูกค้า ",-1)])])):k("",!0),(n(!0),c(L,null,A(C.value,s=>(n(),c("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",ae,[e("div",ne,[e("div",ie,a(s.name.charAt(0).toUpperCase()),1),e("div",de,[F(l,{to:{name:"CustomerDetail",params:{name:s.name}},class:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline"},{default:I(()=>[p(a(s.name),1)]),_:2},1032,["to"]),e("div",ue," อัปเดต: "+a(Q(V)(s.lastUpdate)),1)])])]),e("td",ce,a(s.phoneNumber||"-"),1),e("td",{class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",title:s.address},a(s.address||"-"),9,me),e("td",pe,a(s.note||"-"),1),e("td",xe,[e("div",fe,[e("button",{onClick:y=>B(s),class:"inline-flex items-center rounded-md bg-amber-50 px-2.5 py-1.5 text-xs font-medium text-amber-700 hover:bg-amber-100 border border-amber-200 transition-colors",title:"แก้ไข"},[...t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),p(" แก้ไข ",-1)])],8,be),e("button",{onClick:y=>D(s),"data-testid":"delete-customer-btn","data-customer-id":s.id,class:"inline-flex items-center rounded-md bg-red-50 px-2.5 py-1.5 text-xs font-medium text-red-700 hover:bg-red-100 border border-red-200 transition-colors",title:"ลบ"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),p(" ลบ ",-1)])],8,ve)])])]))),128))])])])]),(n(),E($,{to:"body"},[g.value?(n(),c("div",we,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:v}),e("div",ge,[e("div",he,[e("h3",ye,a(u.value?"แก้ไขข้อมูลลูกค้า":"เพิ่มลูกค้าใหม่"),1),e("button",{onClick:v,class:"rounded-full p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition-colors"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:H(M,["prevent"]),class:"space-y-4"},[e("div",ke,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},[p("ชื่อลูกค้า "),e("span",{class:"text-red-500"},"*")],-1)),x(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>r.value.name=s),disabled:u.value,class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm disabled:bg-gray-100 disabled:text-gray-500",placeholder:"ระบุชื่อลูกค้า (Unique)"},null,8,_e),[[f,r.value.name]]),u.value?(n(),c("p",Ce," ชื่อลูกค้าไม่สามารถแก้ไขได้ (ใช้เป็น ID) ")):k("",!0)]),e("div",Be,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"เบอร์โทรศัพท์",-1)),x(e("input",{type:"tel","onUpdate:modelValue":t[3]||(t[3]=s=>r.value.phoneNumber=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"08x-xxx-xxxx"},null,512),[[f,r.value.phoneNumber]])]),e("div",Ne,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"ที่อยู่จัดส่ง",-1)),x(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.address=s),rows:"3",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"บ้านเลขที่, ถนน, แขวง/เขต..."},null,512),[[f,r.value.address]])]),e("div",Me,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700"},"หมายเหตุ",-1)),x(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>r.value.note=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"Note เพิ่มเติม"},null,512),[[f,r.value.note]])]),e("div",De,[e("button",{type:"button",onClick:v,class:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"}," ยกเลิก "),e("button",Ve,a(u.value?"บันทึกการแก้ไข":"เพิ่มลูกค้า"),1)])],32)])])):k("",!0)]))])}}};export{Te as default};
