import{r as c,c as p,o as oe,e as r,f as e,g,B as N,C as le,q as O,w as m,D as M,v as w,F as S,i as V,t as n,W as ae,E as re,S as f,G as ne,H as de,n as ue,p as l,I as ie,x as ce,h as me,J as xe,y as $,z as pe,K as ge}from"./index-DV1PjDtJ.js";import{A as fe}from"./arrow-left-DEa8UOqL.js";const ve={class:"container mx-auto max-w-7xl px-4 py-8"},be={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},ye={class:"flex items-center gap-4"},we={class:"mb-6 rounded-xl bg-white shadow-sm border border-gray-200 p-4"},he={class:"flex flex-col gap-4"},_e={class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},ke={key:0,class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},Ce={key:0,class:"flex-1 flex flex-col sm:flex-row gap-3"},De={class:"flex-1"},Ne={class:"flex-1"},Me={key:1,class:"flex-1 flex flex-col sm:flex-row gap-3"},Se=["value"],Ve=["value"],je={key:2,class:"flex-1"},Be=["value"],Te={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4"},Ue={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Ee={class:"flex items-center justify-between"},Oe={class:"text-3xl font-bold text-green-600"},$e={class:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center"},Ae={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Fe={class:"flex items-center justify-between"},He={class:"text-3xl font-bold text-gray-700"},Ie={class:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center"},Pe={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Ye={class:"space-y-2"},Re={class:"flex items-center justify-between"},ze={class:"text-sm font-semibold text-green-600"},Le={class:"flex items-center justify-between"},We={class:"text-sm font-semibold text-blue-600"},qe={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},Ge={class:"overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200"},Ke={class:"bg-white divide-y divide-gray-200"},Qe={key:0},Xe={key:1},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},et={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},tt={class:"px-6 py-4 whitespace-nowrap text-sm"},st={key:1,class:"text-gray-600"},ot={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},lt={class:"px-6 py-4 whitespace-nowrap"},at={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},rt=["onClick"],nt=["onClick"],dt={key:0,class:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200"},ut={class:"text-sm text-gray-700"},it={class:"flex gap-2"},ct=["disabled"],mt={class:"px-4 py-2 text-sm font-medium text-gray-700"},xt=["disabled"],pt={key:1,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},gt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ft={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},vt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},bt={class:"space-y-4"},A=20,_t={__name:"AllSalesView",setup(yt){const Y=le(),h=c(!1),a=c([]),x=c("month"),v=c(""),b=c(""),F=new Date,_=c(F.getMonth()),y=c(F.getFullYear()),i=c(1),j=c(!1),k=c(null),u=c({date:"",time:"",customerName:"",amount:0}),R=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],H=p(()=>{const s=new Date().getFullYear(),t=[];for(let d=s-5;d<=s+1;d++)t.push(d);return t}),z=p(()=>a.value.reduce((s,t)=>s+(t.amount||0),0)),L=p(()=>a.value.length),W=p(()=>a.value.filter(s=>s.type!=="COD").reduce((s,t)=>s+(t.amount||0),0)),q=p(()=>a.value.filter(s=>s.type==="COD").reduce((s,t)=>s+(t.amount||0),0)),B=p(()=>Math.ceil(a.value.length/A)||1),T=p(()=>(i.value-1)*A),I=p(()=>{const s=T.value+A;return s>a.value.length?a.value.length:s}),P=p(()=>a.value.slice(T.value,I.value)),G=()=>{i.value=1},J=async()=>{i.value=1,await U()},K=()=>{x.value="month";const s=new Date;_.value=s.getMonth(),y.value=s.getFullYear(),v.value="",b.value="",i.value=1,U()},U=async()=>{h.value=!0,a.value=[];try{if(x.value==="custom"&&(!v.value||!b.value)){f.fire({icon:"warning",title:"กรุณาเลือกวันที่",text:"กรุณาระบุวันที่เริ่มต้นและสิ้นสุด"}),h.value=!1;return}a.value=await ne({mode:x.value,startDate:v.value?new Date(v.value):null,endDate:b.value?new Date(b.value):null,month:_.value,year:y.value,limitCount:200})}catch(s){console.error("Error fetching sales:",s),f.fire("Error",s.message,"error")}finally{h.value=!1}},Q=()=>{i.value>1&&i.value--},X=()=>{i.value<B.value&&i.value++},Z=async s=>{if((await f.fire({title:"ยืนยันการลบ?",text:`ต้องการลบรายการ ${s.orderNo||""} นี้หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await ge(s.id),a.value=a.value.filter(d=>d.id!==s.id),f.fire("Deleted!","ลบรายการสำเร็จ","success")}catch(d){f.fire("Error",d.message,"error")}},ee=s=>{k.value=s.id;let t=new Date;s.dateTime&&s.dateTime.toDate?t=s.dateTime.toDate():s.date&&(t=new Date(s.date)),u.value={date:$(t,"yyyy-MM-dd"),time:$(t,"HH:mm"),customerName:s.customerName||"",amount:s.amount||0},j.value=!0},E=()=>{j.value=!1,k.value=null},te=async()=>{try{const s=new Date(`${u.value.date}T${u.value.time}`),t={dateTime:s,date:s,customerName:u.value.customerName,amount:Number(u.value.amount)};await de(k.value,t);const d=a.value.findIndex(o=>o.id===k.value);d!==-1&&(a.value[d]={...a.value[d],...t}),f.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),E()}catch(s){console.error("Update error:",s),f.fire("Error","บันทึกไม่สำเร็จ","error")}},se=s=>{if(!s)return"-";try{const t=s.toDate?s.toDate():new Date(s),d=t.getFullYear()+543;return $(t,`d MMM ${String(d).slice(-2)} HH:mm`,{locale:pe})}catch{return"-"}},C=s=>new Intl.NumberFormat("th-TH").format(s||0);return oe(()=>{U()}),(s,t)=>{const d=ue("router-link");return l(),r("div",ve,[e("div",be,[e("div",ye,[e("button",{onClick:t[0]||(t[0]=o=>N(Y).push("/")),class:"flex items-center justify-center rounded-lg border border-gray-200 bg-white p-2 text-gray-600 shadow-sm hover:bg-gray-50 hover:text-blue-600 transition-colors"},[O(N(fe),{class:"h-5 w-5"})]),t[11]||(t[11]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"ประวัติยอดขายทั้งหมด"),e("p",{class:"text-gray-500"},"จัดการรายการขายและตรวจสอบย้อนหลัง")],-1))])]),e("div",we,[e("div",he,[e("div",_e,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"โหมดการกรอง:",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>x.value=o),onChange:G,class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[...t[12]||(t[12]=[e("option",{value:"all"},"ทั้งหมด (All Time)",-1),e("option",{value:"custom"},"กำหนดช่วงวัน (Custom Range)",-1),e("option",{value:"month"},"รายเดือน (Specific Month)",-1),e("option",{value:"year"},"รายปี (Specific Year)",-1)])],544),[[M,x.value]])]),x.value!=="all"?(l(),r("div",ke,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"ช่วงเวลา:",-1)),x.value==="custom"?(l(),r("div",Ce,[e("div",De,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่เริ่มต้น",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>v.value=o),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,v.value]])]),e("div",Ne,[t[15]||(t[15]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่สิ้นสุด",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,b.value]])])])):g("",!0),x.value==="month"?(l(),r("div",Me,[m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>_.value=o),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(),r(S,null,V(R,(o,D)=>e("option",{key:D,value:D},n(o),9,Se)),64))],512),[[M,_.value]]),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>y.value=o),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(S,null,V(H.value,o=>(l(),r("option",{key:o,value:o},n(o),9,Ve))),128))],512),[[M,y.value]])])):g("",!0),x.value==="year"?(l(),r("div",je,[m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>y.value=o),class:"w-full rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(S,null,V(H.value,o=>(l(),r("option",{key:o,value:o},n(o),9,Be))),128))],512),[[M,y.value]])])):g("",!0)])):g("",!0),e("div",{class:"flex gap-3 justify-end"},[e("button",{onClick:J,class:"px-6 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-sm hover:bg-blue-700 transition-colors"}," ค้นหา "),e("button",{onClick:K,class:"px-6 py-2 bg-gray-500 text-white font-medium rounded-lg shadow-sm hover:bg-gray-600 transition-colors"}," รีเซ็ต ")])])]),a.value.length>0?(l(),r("div",Te,[e("div",Ue,[e("div",Ee,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"ยอดรวมทั้งหมด",-1)),e("p",Oe," ฿"+n(C(z.value)),1)]),e("div",$e,[O(N(ae),{class:"h-6 w-6 text-green-600"})])])]),e("div",Ae,[e("div",Fe,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"จำนวนออเดอร์",-1)),e("p",He,n(L.value),1)]),e("div",Ie,[O(N(re),{class:"h-6 w-6 text-blue-600"})])])]),e("div",Pe,[t[21]||(t[21]=e("p",{class:"text-sm font-medium text-gray-500 mb-3"},"สัดส่วนประเภท",-1)),e("div",Ye,[e("div",Re,[t[19]||(t[19]=e("span",{class:"text-sm text-gray-600"},"โอนเงิน:",-1)),e("span",ze,"฿"+n(C(W.value)),1)]),e("div",Le,[t[20]||(t[20]=e("span",{class:"text-sm text-gray-600"},"COD:",-1)),e("span",We,"฿"+n(C(q.value)),1)])])])])):g("",!0),e("div",qe,[e("div",Ge,[e("table",Je,[t[24]||(t[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," วันที่ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," Order No. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ชื่อลูกค้า "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ยอดเงิน "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ประเภท "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," จัดการ ")])],-1)),e("tbody",Ke,[h.value?(l(),r("tr",Qe,[...t[22]||(t[22]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," กำลังโหลดข้อมูล... ",-1)])])):P.value.length===0?(l(),r("tr",Xe,[...t[23]||(t[23]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," ไม่พบรายการขายในช่วงเวลาที่เลือก ",-1)])])):g("",!0),(l(!0),r(S,null,V(P.value,o=>(l(),r("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ze,n(se(o.dateTime)),1),e("td",et,n(o.orderNo||"-"),1),e("td",tt,[o.customerName?(l(),ie(d,{key:0,to:{name:"CustomerDetail",params:{name:o.customerName}},class:"text-blue-600 hover:text-blue-800 hover:underline font-medium"},{default:ce(()=>[me(n(o.customerName),1)]),_:2},1032,["to"])):(l(),r("span",st,"ไม่ระบุ"))]),e("td",ot," ฿"+n(C(o.amount)),1),e("td",lt,[e("span",{class:xe(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-blue-100 text-blue-800":o.type==="COD","bg-green-100 text-green-800":o.type!=="COD"}])},n(o.type==="COD"?"COD":"โอนเงิน"),3)]),e("td",at,[e("button",{onClick:D=>ee(o),class:"text-indigo-600 hover:text-indigo-900 mr-4"}," แก้ไข ",8,rt),e("button",{onClick:D=>Z(o),class:"text-red-600 hover:text-red-900"}," ลบ ",8,nt)])]))),128))])])]),a.value.length>0?(l(),r("div",dt,[e("div",ut," แสดง "+n(T.value+1)+"-"+n(I.value)+" จาก "+n(a.value.length)+" รายการ ",1),e("div",it,[e("button",{onClick:Q,disabled:i.value===1,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ก่อนหน้า ",8,ct),e("div",mt," หน้า "+n(i.value)+" / "+n(B.value),1),e("button",{onClick:X,disabled:i.value===B.value,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ถัดไป ",8,xt)])])):g("",!0)]),j.value?(l(),r("div",pt,[e("div",gt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:E}),t[30]||(t[30]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ft,[e("div",vt,[t[29]||(t[29]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4",id:"modal-title"}," แก้ไขรายการขาย ",-1)),e("div",bt,[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"วันที่",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=o=>u.value.date=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,u.value.date]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"เวลา",-1)),m(e("input",{type:"time","onUpdate:modelValue":t[8]||(t[8]=o=>u.value.time=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,u.value.time]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อลูกค้า",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=o=>u.value.customerName=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,u.value.customerName]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700"},"ยอดเงิน",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=o=>u.value.amount=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,u.value.amount,void 0,{number:!0}]])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{onClick:te,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"}," บันทึก "),e("button",{onClick:E,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," ยกเลิก ")])])])])):g("",!0)])}}};export{_t as default};
