import{y as se,r,c as oe,o as ae,e as n,f as e,g as D,z as I,A as le,B as re,w as p,v as b,C as L,F as B,i as V,D as ne,E as ue,a as de,k as E,G as $,H as _,I as z,J as A,K as ie,L as ce,S as f,u as me,j as F,n as u,t as x,M as pe,p as O,q as xe,x as fe}from"./index-hcWvTMh3.js";const ve=se("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),ge={class:"container mx-auto max-w-7xl px-4 py-8"},ye={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},be={class:"flex items-center gap-4"},we={class:"flex flex-col gap-3 sm:flex-row sm:items-center w-full md:w-auto"},he={class:"relative w-full sm:w-64"},ke={class:"flex items-center gap-2"},Ce=["value"],De=["value"],_e={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},Me={class:"overflow-x-auto"},Ne={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-white divide-y divide-gray-200"},Be={key:0},Ve={key:1},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},je={class:"px-6 py-4 whitespace-nowrap"},He={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ie=["onClick"],Le=["onClick"],$e={key:0,class:"bg-gray-50 px-6 py-4 text-center border-t border-gray-200"},ze={key:1,class:"bg-gray-50 px-6 py-4 text-center border-t border-gray-200"},Ae={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Fe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},qe={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ye={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Re={class:"space-y-4"},Ke={__name:"AllSalesView",setup(Ge){const q=le(),c=r(!1),a=r([]),v=r(null),g=r(!0),S=new Date,w=r(S.getMonth()),h=r(S.getFullYear()),m=r(""),M=r(null),N=r(!1),k=r(null),l=r({date:"",time:"",customerName:"",amount:0}),Y=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],R=oe(()=>{const o=new Date().getFullYear(),t=[];for(let s=o-2;s<=o+1;s++)t.push(s);return t}),U=()=>{a.value=[],v.value=null,g.value=!0,C()},G=()=>{M.value&&clearTimeout(M.value),a.value=[],v.value=null,M.value=setTimeout(()=>{C()},500)},C=async()=>{c.value=!0;try{const o=ne(new Date(h.value,w.value)),t=ue(new Date(h.value,w.value)),s=de(E,"sales");let d;if(m.value)d=$(s,_("dateTime",">=",o),_("dateTime","<=",t),z("dateTime","desc"),A(500));else{let i=[_("dateTime",">=",o),_("dateTime","<=",t),z("dateTime","desc"),A(20)];v.value&&i.push(ie(v.value)),d=$(s,...i)}const y=await ce(d);if(y.empty){g.value=!1,c.value=!1;return}!m.value&&y.docs.length<20&&(g.value=!1),v.value=y.docs[y.docs.length-1];const j=y.docs.map(i=>({id:i.id,...i.data()}));if(m.value){const i=m.value.toLowerCase(),Z=j.filter(H=>{const ee=(H.orderNo||"").toLowerCase(),te=(H.customerName||"").toLowerCase();return ee.includes(i)||te.includes(i)});a.value=Z}else a.value.push(...j)}catch(o){console.error("Error fetching sales:",o),f.fire("Error",o.message,"error")}finally{c.value=!1}},J=()=>{!g.value||c.value||C()},K=async o=>{if((await f.fire({title:"ยืนยันการลบ?",text:`ต้องการลบรายการ ${o.orderNo||""} นี้หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await fe(F(E,"sales",o.id)),a.value=a.value.filter(s=>s.id!==o.id),f.fire("Deleted!","ลบรายการสำเร็จ","success")}catch(s){f.fire("Error",s.message,"error")}},Q=o=>{k.value=o.id;let t=new Date;o.dateTime&&o.dateTime.toDate?t=o.dateTime.toDate():o.date&&(t=new Date(o.date)),l.value={date:O(t,"yyyy-MM-dd"),time:O(t,"HH:mm"),customerName:o.customerName||"",amount:o.amount||0},N.value=!0},T=()=>{N.value=!1,k.value=null},P=async()=>{try{const o=new Date(`${l.value.date}T${l.value.time}`),t={dateTime:o,date:o,customerName:l.value.customerName,amount:Number(l.value.amount)};await me(F(E,"sales",k.value),t);const s=a.value.findIndex(d=>d.id===k.value);s!==-1&&(a.value[s]={...a.value[s],...t}),f.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),T()}catch(o){console.error("Update error:",o),f.fire("Error","บันทึกไม่สำเร็จ","error")}},W=o=>{if(!o)return"-";try{const t=o.toDate?o.toDate():new Date(o),s=t.getFullYear()+543;return O(t,`d MMM ${String(s).slice(-2)} HH:mm`,{locale:xe})}catch{return"-"}},X=o=>new Intl.NumberFormat("th-TH").format(o||0);return ae(()=>{C()}),(o,t)=>(u(),n("div",ge,[e("div",ye,[e("div",be,[e("button",{onClick:t[0]||(t[0]=s=>I(q).push("/")),class:"flex items-center justify-center rounded-lg border border-gray-200 bg-white p-2 text-gray-600 shadow-sm hover:bg-gray-50 hover:text-blue-600 transition-colors"},[re(I(ve),{class:"h-5 w-5"})]),t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"ประวัติยอดขายทั้งหมด"),e("p",{class:"text-gray-500"},"จัดการรายการขายและตรวจสอบย้อนหลัง")],-1))]),e("div",we,[e("div",he,[t[9]||(t[9]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),p(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),onInput:G,placeholder:"ค้นหา Order No, ชื่อลูกค้า...",class:"block w-full rounded-lg border-gray-300 pl-10 focus:border-blue-500 focus:ring-blue-500 shadow-sm"},null,544),[[b,m.value]])]),e("div",ke,[p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),onChange:U,class:"rounded-lg border-gray-300 bg-white px-3 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(u(),n(B,null,V(Y,(s,d)=>e("option",{key:d,value:d},x(s),9,Ce)),64))],544),[[L,w.value]]),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),onChange:U,class:"rounded-lg border-gray-300 bg-white px-3 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(u(!0),n(B,null,V(R.value,s=>(u(),n("option",{key:s,value:s},x(s),9,De))),128))],544),[[L,h.value]])])])]),e("div",_e,[e("div",Me,[e("table",Ne,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"วันที่"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"Order No."),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ชื่อลูกค้า"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ยอดเงิน"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"ประเภท"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},"จัดการ")])],-1)),e("tbody",Te,[c.value&&a.value.length===0?(u(),n("tr",Be,[...t[10]||(t[10]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"},"กำลังโหลดข้อมูล...",-1)])])):a.value.length===0?(u(),n("tr",Ve,[...t[11]||(t[11]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"},"ไม่พบรายการขายในเดือนนี้",-1)])])):D("",!0),(u(!0),n(B,null,V(a.value,s=>(u(),n("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ee,x(W(s.dateTime)),1),e("td",Oe,x(s.orderNo||"-"),1),e("td",Se,x(s.customerName||"ไม่ระบุ"),1),e("td",Ue," ฿"+x(X(s.amount)),1),e("td",je,[e("span",{class:pe(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-blue-100 text-blue-800":s.type==="COD","bg-green-100 text-green-800":s.type!=="COD"}])},x(s.type==="COD"?"COD":"โอนเงิน"),3)]),e("td",He,[e("button",{onClick:d=>Q(s),class:"text-indigo-600 hover:text-indigo-900 mr-4"},"แก้ไข",8,Ie),e("button",{onClick:d=>K(s),class:"text-red-600 hover:text-red-900"},"ลบ",8,Le)])]))),128))])])]),g.value&&!m.value&&!c.value?(u(),n("div",$e,[e("button",{onClick:J,class:"text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors"}," โหลดเพิ่มเติม... ")])):D("",!0),c.value&&a.value.length>0?(u(),n("div",ze,[...t[13]||(t[13]=[e("span",{class:"text-sm text-gray-500"},"กำลังโหลด...",-1)])])):D("",!0)]),N.value?(u(),n("div",Ae,[e("div",Fe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:T}),t[19]||(t[19]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",qe,[e("div",Ye,[t[18]||(t[18]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4",id:"modal-title"},"แก้ไขรายการขาย",-1)),e("div",Re,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"วันที่",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=s=>l.value.date=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,l.value.date]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"เวลา",-1)),p(e("input",{type:"time","onUpdate:modelValue":t[5]||(t[5]=s=>l.value.time=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,l.value.time]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อลูกค้า",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>l.value.customerName=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,l.value.customerName]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"ยอดเงิน",-1)),p(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=s=>l.value.amount=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[b,l.value.amount,void 0,{number:!0}]])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{onClick:P,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"},"บันทึก"),e("button",{onClick:T,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"},"ยกเลิก")])])])])):D("",!0)]))}};export{Ke as default};
