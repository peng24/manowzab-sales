import{r as c,c as p,o as ae,e as r,f as e,i as g,g as P,u as _,D as re,p as $,w as m,E as j,v as w,F as S,j as B,t as n,W as ne,G as de,k as ie,T as ue,S as v,H as ce,m as me,n as l,s as xe,q as pe,h as A,I as ge,J as q,K as ve,L as be}from"./index-B3zZU_Hv.js";import{A as fe}from"./arrow-left-BsvjtutR.js";const ye={class:"container mx-auto max-w-7xl px-4 py-8"},we={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},he={class:"flex items-center gap-4"},_e={class:"mb-6 rounded-xl bg-white shadow-sm border border-gray-200 p-4"},ke={class:"flex flex-col gap-4"},Ce={class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},De={key:0,class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},Me={key:0,class:"flex-1 flex flex-col sm:flex-row gap-3"},Ne={class:"flex-1"},je={class:"flex-1"},Se={key:1,class:"flex-1 flex flex-col sm:flex-row gap-3"},Be=["value"],Te=["value"],Ve={key:2,class:"flex-1"},Ue=["value"],Oe={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4"},$e={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Ae={class:"flex items-center justify-between"},Ee={class:"text-3xl font-bold text-green-600"},Fe={class:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center"},He={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Ie={class:"flex items-center justify-between"},Le={class:"text-3xl font-bold text-gray-700"},Pe={class:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center"},qe={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Ye={class:"space-y-2"},Re={class:"flex items-center justify-between"},ze={class:"text-sm font-semibold text-green-600"},We={class:"flex items-center justify-between"},Ge={class:"text-sm font-semibold text-blue-600"},Je={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},Ke={class:"overflow-x-auto"},Qe={class:"min-w-full divide-y divide-gray-200"},Xe={class:"bg-white divide-y divide-gray-200"},Ze={key:0},et={key:1},tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},st={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ot={class:"px-6 py-4 whitespace-nowrap text-sm"},lt={key:1,class:"text-gray-600"},at={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},rt={class:"px-6 py-4 whitespace-nowrap"},nt={class:"px-6 py-4 whitespace-nowrap text-sm text-center"},dt={class:"flex items-center justify-end gap-2"},it=["onClick"],ut=["onClick"],ct={key:0,class:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200"},mt={class:"text-sm text-gray-700"},xt={class:"flex gap-2"},pt=["disabled"],gt={class:"px-4 py-2 text-sm font-medium text-gray-700"},vt=["disabled"],bt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ft={class:"relative w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl animate-fade-in-up"},yt={class:"grid grid-cols-2 gap-4"},wt={class:"space-y-1"},ht={class:"space-y-1"},_t={class:"space-y-1"},kt={class:"space-y-1"},E=20,Nt={__name:"AllSalesView",setup(Ct){const Y=re(),k=c(!1),a=c([]),x=c("month"),b=c(""),f=c(""),F=new Date,C=c(F.getMonth()),y=c(F.getFullYear()),u=c(1),T=c(!1),D=c(null),d=c({date:"",time:"",customerName:"",amount:0}),R=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],H=p(()=>{const o=new Date().getFullYear(),t=[];for(let i=o-5;i<=o+1;i++)t.push(i);return t}),z=p(()=>a.value.reduce((o,t)=>o+(t.amount||0),0)),W=p(()=>a.value.length),G=p(()=>a.value.filter(o=>o.type!=="COD").reduce((o,t)=>o+(t.amount||0),0)),J=p(()=>a.value.filter(o=>o.type==="COD").reduce((o,t)=>o+(t.amount||0),0)),V=p(()=>Math.ceil(a.value.length/E)||1),U=p(()=>(u.value-1)*E),I=p(()=>{const o=U.value+E;return o>a.value.length?a.value.length:o}),L=p(()=>a.value.slice(U.value,I.value)),K=()=>{u.value=1},Q=async()=>{u.value=1,await O()},X=()=>{x.value="month";const o=new Date;C.value=o.getMonth(),y.value=o.getFullYear(),b.value="",f.value="",u.value=1,O()},O=async()=>{k.value=!0,a.value=[];try{if(x.value==="custom"&&(!b.value||!f.value)){v.fire({icon:"warning",title:"กรุณาเลือกวันที่",text:"กรุณาระบุวันที่เริ่มต้นและสิ้นสุด"}),k.value=!1;return}a.value=await ce({mode:x.value,startDate:b.value?new Date(b.value):null,endDate:f.value?new Date(f.value):null,month:C.value,year:y.value,limitCount:200})}catch(o){console.error("Error fetching sales:",o),v.fire("Error",o.message,"error")}finally{k.value=!1}},Z=()=>{u.value>1&&u.value--},ee=()=>{u.value<V.value&&u.value++},te=async o=>{if((await v.fire({icon:"warning",title:"ยืนยันการลบ",html:`ต้องการลบรายการ <b>${o.orderNo||""}</b><br>ลูกค้า: <b>${o.customerName||"ไม่ระบุ"}</b> ยอด ฿${h(o.amount)}?`,showCancelButton:!0,showDenyButton:!1,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"ลบรายการ",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await ve(o.id),a.value=a.value.filter(i=>i.id!==o.id),v.fire({icon:"success",title:"ลบสำเร็จ",text:"ลบรายการเรียบร้อยแล้ว",timer:1500,showConfirmButton:!1})}catch(i){v.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:i.message})}},se=o=>{D.value=o.id;let t=new Date;o.dateTime&&o.dateTime.toDate?t=o.dateTime.toDate():o.date&&(t=new Date(o.date)),d.value={date:q(t,"yyyy-MM-dd"),time:q(t,"HH:mm"),customerName:o.customerName||"",amount:o.amount||0},T.value=!0},M=()=>{T.value=!1,D.value=null},oe=async()=>{try{const o=new Date(`${d.value.date}T${d.value.time}`),t={dateTime:o,date:o,customerName:d.value.customerName,amount:Number(d.value.amount)};await be(D.value,t);const i=a.value.findIndex(s=>s.id===D.value);i!==-1&&(a.value[i]={...a.value[i],...t}),v.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),M()}catch(o){console.error("Update error:",o),v.fire("Error","บันทึกไม่สำเร็จ","error")}},le=xe,h=o=>new Intl.NumberFormat("th-TH").format(o||0);return ae(()=>{O()}),(o,t)=>{const i=me("router-link");return l(),r("div",ye,[e("div",we,[e("div",he,[e("button",{onClick:t[0]||(t[0]=s=>_(Y).push("/")),class:"flex items-center justify-center rounded-lg border border-gray-200 bg-white p-2 text-gray-600 shadow-sm hover:bg-gray-50 hover:text-blue-600 transition-colors"},[$(_(fe),{class:"h-5 w-5"})]),t[11]||(t[11]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"ประวัติยอดขายทั้งหมด"),e("p",{class:"text-gray-500"},"จัดการรายการขายและตรวจสอบย้อนหลัง")],-1))])]),e("div",_e,[e("div",ke,[e("div",Ce,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"โหมดการกรอง:",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),onChange:K,class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[...t[12]||(t[12]=[e("option",{value:"all"},"ทั้งหมด (All Time)",-1),e("option",{value:"custom"},"กำหนดช่วงวัน (Custom Range)",-1),e("option",{value:"month"},"รายเดือน (Specific Month)",-1),e("option",{value:"year"},"รายปี (Specific Year)",-1)])],544),[[j,x.value]])]),x.value!=="all"?(l(),r("div",De,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"ช่วงเวลา:",-1)),x.value==="custom"?(l(),r("div",Me,[e("div",Ne,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่เริ่มต้น",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,b.value]])]),e("div",je,[t[15]||(t[15]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่สิ้นสุด",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[w,f.value]])])])):g("",!0),x.value==="month"?(l(),r("div",Se,[m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.value=s),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(),r(S,null,B(R,(s,N)=>e("option",{key:N,value:N},n(s),9,Be)),64))],512),[[j,C.value]]),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>y.value=s),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(S,null,B(H.value,s=>(l(),r("option",{key:s,value:s},n(s),9,Te))),128))],512),[[j,y.value]])])):g("",!0),x.value==="year"?(l(),r("div",Ve,[m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>y.value=s),class:"w-full rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(S,null,B(H.value,s=>(l(),r("option",{key:s,value:s},n(s),9,Ue))),128))],512),[[j,y.value]])])):g("",!0)])):g("",!0),e("div",{class:"flex gap-3 justify-end"},[e("button",{onClick:Q,class:"px-6 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-sm hover:bg-blue-700 transition-colors"}," ค้นหา "),e("button",{onClick:X,class:"px-6 py-2 bg-gray-500 text-white font-medium rounded-lg shadow-sm hover:bg-gray-600 transition-colors"}," รีเซ็ต ")])])]),a.value.length>0?(l(),r("div",Oe,[e("div",$e,[e("div",Ae,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"ยอดรวมทั้งหมด",-1)),e("p",Ee," ฿"+n(h(z.value)),1)]),e("div",Fe,[$(_(ne),{class:"h-6 w-6 text-green-600"})])])]),e("div",He,[e("div",Ie,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"จำนวนออเดอร์",-1)),e("p",Le,n(W.value),1)]),e("div",Pe,[$(_(de),{class:"h-6 w-6 text-blue-600"})])])]),e("div",qe,[t[21]||(t[21]=e("p",{class:"text-sm font-medium text-gray-500 mb-3"},"สัดส่วนประเภท",-1)),e("div",Ye,[e("div",Re,[t[19]||(t[19]=e("span",{class:"text-sm text-gray-600"},"โอนเงิน:",-1)),e("span",ze,"฿"+n(h(G.value)),1)]),e("div",We,[t[20]||(t[20]=e("span",{class:"text-sm text-gray-600"},"COD:",-1)),e("span",Ge,"฿"+n(h(J.value)),1)])])])])):g("",!0),e("div",Je,[e("div",Ke,[e("table",Qe,[t[26]||(t[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," วันที่ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," Order No. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ชื่อลูกค้า "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ยอดเงิน "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ประเภท "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," จัดการ ")])],-1)),e("tbody",Xe,[k.value?(l(),r("tr",Ze,[...t[22]||(t[22]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," กำลังโหลดข้อมูล... ",-1)])])):L.value.length===0?(l(),r("tr",et,[...t[23]||(t[23]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," ไม่พบรายการขายในช่วงเวลาที่เลือก ",-1)])])):g("",!0),(l(!0),r(S,null,B(L.value,s=>(l(),r("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",tt,n(_(le)(s.dateTime)),1),e("td",st,n(s.orderNo||"-"),1),e("td",ot,[s.customerName?(l(),P(i,{key:0,to:{name:"CustomerDetail",params:{name:s.customerName}},class:"text-blue-600 hover:text-blue-800 hover:underline font-medium"},{default:pe(()=>[A(n(s.customerName),1)]),_:2},1032,["to"])):(l(),r("span",lt,"ไม่ระบุ"))]),e("td",at," ฿"+n(h(s.amount)),1),e("td",rt,[e("span",{class:ge(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-blue-100 text-blue-800":s.type==="COD","bg-green-100 text-green-800":s.type!=="COD"}])},n(s.type==="COD"?"COD":"โอนเงิน"),3)]),e("td",nt,[e("div",dt,[e("button",{onClick:N=>se(s),class:"inline-flex items-center rounded-md bg-amber-50 px-2.5 py-1.5 text-xs font-medium text-amber-700 hover:bg-amber-100 border border-amber-200 transition-colors",title:"แก้ไข"},[...t[24]||(t[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),A(" แก้ไข ",-1)])],8,it),e("button",{onClick:N=>te(s),class:"inline-flex items-center rounded-md bg-red-50 px-2.5 py-1.5 text-xs font-medium text-red-700 hover:bg-red-100 border border-red-200 transition-colors",title:"ลบ"},[...t[25]||(t[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),A(" ลบ ",-1)])],8,ut)])])]))),128))])])]),a.value.length>0?(l(),r("div",ct,[e("div",mt," แสดง "+n(U.value+1)+"-"+n(I.value)+" จาก "+n(a.value.length)+" รายการ ",1),e("div",xt,[e("button",{onClick:Z,disabled:u.value===1,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ก่อนหน้า ",8,pt),e("div",gt," หน้า "+n(u.value)+" / "+n(V.value),1),e("button",{onClick:ee,disabled:u.value===V.value,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ถัดไป ",8,vt)])])):g("",!0)]),(l(),P(ue,{to:"body"},[T.value?(l(),r("div",bt,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:M}),e("div",ft,[e("div",{class:"flex items-center justify-between mb-6"},[t[28]||(t[28]=e("h3",{class:"text-lg font-bold text-gray-800"},"แก้ไขรายการขาย",-1)),e("button",{onClick:M,class:"rounded-full p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition-colors"},[...t[27]||(t[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ie(oe,["prevent"]),class:"space-y-4"},[e("div",yt,[e("div",wt,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700"},"วันที่",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=s=>d.value.date=s),required:"",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"},null,512),[[w,d.value.date]])]),e("div",ht,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"เวลา",-1)),m(e("input",{type:"time","onUpdate:modelValue":t[8]||(t[8]=s=>d.value.time=s),required:"",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"},null,512),[[w,d.value.time]])])]),e("div",_t,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อลูกค้า",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=s=>d.value.customerName=s),required:"",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"},null,512),[[w,d.value.customerName]])]),e("div",kt,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700"},"ยอดเงิน (บาท)",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=s=>d.value.amount=s),step:"0.01",min:"0",required:"",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"},null,512),[[w,d.value.amount,void 0,{number:!0}]])]),e("div",{class:"flex justify-end gap-3 pt-2"},[e("button",{type:"button",onClick:M,class:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"}," ยกเลิก "),t[33]||(t[33]=e("button",{type:"submit",class:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 transition-colors"}," บันทึกการแก้ไข ",-1))])],32)])])):g("",!0)]))])}}};export{Nt as default};
