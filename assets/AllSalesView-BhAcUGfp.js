import{r as m,c as f,o as de,e as r,f as e,g as v,B as M,C as ie,q as P,w as p,D as N,v as y,F as O,i as j,t as d,W as ue,E as ce,a as me,k as $,G as S,H as V,I as xe,S as b,J as pe,K as ge,L as w,M as fe,N as ve,O as be,P as ye,Q as we,u as he,j as L,n as _e,p as l,R as ke,x as De,h as Ce,T as Te,y as F,z as Me,A as Ne}from"./index-qMo-vOBa.js";import{A as Oe}from"./arrow-left-Dy8JKM38.js";const je={class:"container mx-auto max-w-7xl px-4 py-8"},Se={class:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"},Ve={class:"flex items-center gap-4"},Be={class:"mb-6 rounded-xl bg-white shadow-sm border border-gray-200 p-4"},Ue={class:"flex flex-col gap-4"},Ee={class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},Ye={key:0,class:"flex flex-col sm:flex-row gap-4 items-start sm:items-center"},Ae={key:0,class:"flex-1 flex flex-col sm:flex-row gap-3"},Pe={class:"flex-1"},$e={class:"flex-1"},Fe={key:1,class:"flex-1 flex flex-col sm:flex-row gap-3"},He=["value"],Ie=["value"],Re={key:2,class:"flex-1"},qe=["value"],ze={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4"},Le={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},We={class:"flex items-center justify-between"},Ge={class:"text-3xl font-bold text-green-600"},Je={class:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center"},Ke={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},Qe={class:"flex items-center justify-between"},Xe={class:"text-3xl font-bold text-gray-700"},Ze={class:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center"},et={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},tt={class:"space-y-2"},st={class:"flex items-center justify-between"},ot={class:"text-sm font-semibold text-green-600"},lt={class:"flex items-center justify-between"},at={class:"text-sm font-semibold text-blue-600"},rt={class:"rounded-xl bg-white shadow-sm border border-gray-200 overflow-hidden"},nt={class:"overflow-x-auto"},dt={class:"min-w-full divide-y divide-gray-200"},it={class:"bg-white divide-y divide-gray-200"},ut={key:0},ct={key:1},mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},xt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},pt={class:"px-6 py-4 whitespace-nowrap text-sm"},gt={key:1,class:"text-gray-600"},ft={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"},vt={class:"px-6 py-4 whitespace-nowrap"},bt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},yt=["onClick"],wt=["onClick"],ht={key:0,class:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200"},_t={class:"text-sm text-gray-700"},kt={class:"flex gap-2"},Dt=["disabled"],Ct={class:"px-4 py-2 text-sm font-medium text-gray-700"},Tt=["disabled"],Mt={key:1,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Nt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ot={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},jt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},St={class:"space-y-4"},H=20,Et={__name:"AllSalesView",setup(Vt){const W=ie(),D=m(!1),a=m([]),u=m("month"),h=m(""),_=m(""),I=new Date,k=m(I.getMonth()),g=m(I.getFullYear()),c=m(1),B=m(!1),C=m(null),i=m({date:"",time:"",customerName:"",amount:0}),G=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],R=f(()=>{const o=new Date().getFullYear(),t=[];for(let n=o-5;n<=o+1;n++)t.push(n);return t}),J=f(()=>a.value.reduce((o,t)=>o+(t.amount||0),0)),K=f(()=>a.value.length),Q=f(()=>a.value.filter(o=>o.type!=="COD").reduce((o,t)=>o+(t.amount||0),0)),X=f(()=>a.value.filter(o=>o.type==="COD").reduce((o,t)=>o+(t.amount||0),0)),U=f(()=>Math.ceil(a.value.length/H)||1),E=f(()=>(c.value-1)*H),q=f(()=>{const o=E.value+H;return o>a.value.length?a.value.length:o}),z=f(()=>a.value.slice(E.value,q.value)),Z=()=>{c.value=1},ee=async()=>{c.value=1,await Y()},te=()=>{u.value="month";const o=new Date;k.value=o.getMonth(),g.value=o.getFullYear(),h.value="",_.value="",c.value=1,Y()},Y=async()=>{D.value=!0,a.value=[];try{const o=me($,"sales");let t;if(u.value==="all")t=S(o,V("dateTime","desc"),xe(200));else if(u.value==="custom"){if(!h.value||!_.value){b.fire({icon:"warning",title:"กรุณาเลือกวันที่",text:"กรุณาระบุวันที่เริ่มต้นและสิ้นสุด"}),D.value=!1;return}const s=pe(new Date(h.value)),x=ge(new Date(_.value));t=S(o,w("dateTime",">=",s),w("dateTime","<=",x),V("dateTime","desc"))}else if(u.value==="month"){const s=fe(new Date(g.value,k.value)),x=ve(new Date(g.value,k.value));t=S(o,w("dateTime",">=",s),w("dateTime","<=",x),V("dateTime","desc"))}else if(u.value==="year"){const s=be(new Date(g.value,0)),x=ye(new Date(g.value,0));t=S(o,w("dateTime",">=",s),w("dateTime","<=",x),V("dateTime","desc"))}const n=await we(t);a.value=n.docs.map(s=>({id:s.id,...s.data()}))}catch(o){console.error("Error fetching sales:",o),b.fire("Error",o.message,"error")}finally{D.value=!1}},se=()=>{c.value>1&&c.value--},oe=()=>{c.value<U.value&&c.value++},le=async o=>{if((await b.fire({title:"ยืนยันการลบ?",text:`ต้องการลบรายการ ${o.orderNo||""} นี้หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await Ne(L($,"sales",o.id)),a.value=a.value.filter(n=>n.id!==o.id),b.fire("Deleted!","ลบรายการสำเร็จ","success")}catch(n){b.fire("Error",n.message,"error")}},ae=o=>{C.value=o.id;let t=new Date;o.dateTime&&o.dateTime.toDate?t=o.dateTime.toDate():o.date&&(t=new Date(o.date)),i.value={date:F(t,"yyyy-MM-dd"),time:F(t,"HH:mm"),customerName:o.customerName||"",amount:o.amount||0},B.value=!0},A=()=>{B.value=!1,C.value=null},re=async()=>{try{const o=new Date(`${i.value.date}T${i.value.time}`),t={dateTime:o,date:o,customerName:i.value.customerName,amount:Number(i.value.amount)};await he(L($,"sales",C.value),t);const n=a.value.findIndex(s=>s.id===C.value);n!==-1&&(a.value[n]={...a.value[n],...t}),b.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),A()}catch(o){console.error("Update error:",o),b.fire("Error","บันทึกไม่สำเร็จ","error")}},ne=o=>{if(!o)return"-";try{const t=o.toDate?o.toDate():new Date(o),n=t.getFullYear()+543;return F(t,`d MMM ${String(n).slice(-2)} HH:mm`,{locale:Me})}catch{return"-"}},T=o=>new Intl.NumberFormat("th-TH").format(o||0);return de(()=>{Y()}),(o,t)=>{const n=_e("router-link");return l(),r("div",je,[e("div",Se,[e("div",Ve,[e("button",{onClick:t[0]||(t[0]=s=>M(W).push("/")),class:"flex items-center justify-center rounded-lg border border-gray-200 bg-white p-2 text-gray-600 shadow-sm hover:bg-gray-50 hover:text-blue-600 transition-colors"},[P(M(Oe),{class:"h-5 w-5"})]),t[11]||(t[11]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"ประวัติยอดขายทั้งหมด"),e("p",{class:"text-gray-500"},"จัดการรายการขายและตรวจสอบย้อนหลัง")],-1))])]),e("div",Be,[e("div",Ue,[e("div",Ee,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"โหมดการกรอง:",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),onChange:Z,class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 text-sm font-medium shadow-sm focus:border-blue-500 focus:ring-blue-500"},[...t[12]||(t[12]=[e("option",{value:"all"},"ทั้งหมด (All Time)",-1),e("option",{value:"custom"},"กำหนดช่วงวัน (Custom Range)",-1),e("option",{value:"month"},"รายเดือน (Specific Month)",-1),e("option",{value:"year"},"รายปี (Specific Year)",-1)])],544),[[N,u.value]])]),u.value!=="all"?(l(),r("div",Ye,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-gray-700 sm:w-32"},"ช่วงเวลา:",-1)),u.value==="custom"?(l(),r("div",Ae,[e("div",Pe,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่เริ่มต้น",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>h.value=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,h.value]])]),e("div",$e,[t[15]||(t[15]=e("label",{class:"block text-xs text-gray-500 mb-1"},"วันที่สิ้นสุด",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=s=>_.value=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,_.value]])])])):v("",!0),u.value==="month"?(l(),r("div",Fe,[p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>k.value=s),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(),r(O,null,j(G,(s,x)=>e("option",{key:x,value:x},d(s),9,He)),64))],512),[[N,k.value]]),p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>g.value=s),class:"flex-1 rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(O,null,j(R.value,s=>(l(),r("option",{key:s,value:s},d(s),9,Ie))),128))],512),[[N,g.value]])])):v("",!0),u.value==="year"?(l(),r("div",Re,[p(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>g.value=s),class:"w-full rounded-lg border-gray-300 bg-white px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(O,null,j(R.value,s=>(l(),r("option",{key:s,value:s},d(s),9,qe))),128))],512),[[N,g.value]])])):v("",!0)])):v("",!0),e("div",{class:"flex gap-3 justify-end"},[e("button",{onClick:ee,class:"px-6 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-sm hover:bg-blue-700 transition-colors"}," ค้นหา "),e("button",{onClick:te,class:"px-6 py-2 bg-gray-500 text-white font-medium rounded-lg shadow-sm hover:bg-gray-600 transition-colors"}," รีเซ็ต ")])])]),a.value.length>0?(l(),r("div",ze,[e("div",Le,[e("div",We,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"ยอดรวมทั้งหมด",-1)),e("p",Ge," ฿"+d(T(J.value)),1)]),e("div",Je,[P(M(ue),{class:"h-6 w-6 text-green-600"})])])]),e("div",Ke,[e("div",Qe,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"จำนวนออเดอร์",-1)),e("p",Xe,d(K.value),1)]),e("div",Ze,[P(M(ce),{class:"h-6 w-6 text-blue-600"})])])]),e("div",et,[t[21]||(t[21]=e("p",{class:"text-sm font-medium text-gray-500 mb-3"},"สัดส่วนประเภท",-1)),e("div",tt,[e("div",st,[t[19]||(t[19]=e("span",{class:"text-sm text-gray-600"},"โอนเงิน:",-1)),e("span",ot,"฿"+d(T(Q.value)),1)]),e("div",lt,[t[20]||(t[20]=e("span",{class:"text-sm text-gray-600"},"COD:",-1)),e("span",at,"฿"+d(T(X.value)),1)])])])])):v("",!0),e("div",rt,[e("div",nt,[e("table",dt,[t[24]||(t[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," วันที่ "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," Order No. "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ชื่อลูกค้า "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ยอดเงิน "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," ประเภท "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"}," จัดการ ")])],-1)),e("tbody",it,[D.value?(l(),r("tr",ut,[...t[22]||(t[22]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," กำลังโหลดข้อมูล... ",-1)])])):z.value.length===0?(l(),r("tr",ct,[...t[23]||(t[23]=[e("td",{colspan:"6",class:"px-6 py-10 text-center text-gray-500"}," ไม่พบรายการขายในช่วงเวลาที่เลือก ",-1)])])):v("",!0),(l(!0),r(O,null,j(z.value,s=>(l(),r("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[e("td",mt,d(ne(s.dateTime)),1),e("td",xt,d(s.orderNo||"-"),1),e("td",pt,[s.customerName?(l(),ke(n,{key:0,to:{name:"CustomerDetail",params:{name:s.customerName}},class:"text-blue-600 hover:text-blue-800 hover:underline font-medium"},{default:De(()=>[Ce(d(s.customerName),1)]),_:2},1032,["to"])):(l(),r("span",gt,"ไม่ระบุ"))]),e("td",ft," ฿"+d(T(s.amount)),1),e("td",vt,[e("span",{class:Te(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-blue-100 text-blue-800":s.type==="COD","bg-green-100 text-green-800":s.type!=="COD"}])},d(s.type==="COD"?"COD":"โอนเงิน"),3)]),e("td",bt,[e("button",{onClick:x=>ae(s),class:"text-indigo-600 hover:text-indigo-900 mr-4"}," แก้ไข ",8,yt),e("button",{onClick:x=>le(s),class:"text-red-600 hover:text-red-900"}," ลบ ",8,wt)])]))),128))])])]),a.value.length>0?(l(),r("div",ht,[e("div",_t," แสดง "+d(E.value+1)+"-"+d(q.value)+" จาก "+d(a.value.length)+" รายการ ",1),e("div",kt,[e("button",{onClick:se,disabled:c.value===1,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ก่อนหน้า ",8,Dt),e("div",Ct," หน้า "+d(c.value)+" / "+d(U.value),1),e("button",{onClick:oe,disabled:c.value===U.value,class:"px-4 py-2 text-sm font-medium rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ถัดไป ",8,Tt)])])):v("",!0)]),B.value?(l(),r("div",Mt,[e("div",Nt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:A}),t[30]||(t[30]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ot,[e("div",jt,[t[29]||(t[29]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4",id:"modal-title"}," แก้ไขรายการขาย ",-1)),e("div",St,[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"วันที่",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=s=>i.value.date=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,i.value.date]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"เวลา",-1)),p(e("input",{type:"time","onUpdate:modelValue":t[8]||(t[8]=s=>i.value.time=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,i.value.time]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อลูกค้า",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=s=>i.value.customerName=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,i.value.customerName]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700"},"ยอดเงิน",-1)),p(e("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=s=>i.value.amount=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,i.value.amount,void 0,{number:!0}]])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{onClick:re,type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm"}," บันทึก "),e("button",{onClick:A,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," ยกเลิก ")])])])])):v("",!0)])}}};export{Et as default};
